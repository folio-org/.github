name: FOLIO UI Calculate CI Version Number

on:
  workflow_call:
    outputs:
      version-number:
        description: The derived version number unique to this run
        value: ${{ jobs.get-version-number.outputs.version-number }}

jobs:
  get-version-number:
    name: Get CI version number
    runs-on: ubuntu-latest

    outputs:
      version-number: ${{ steps.calculate.outputs.version }}

    steps:
      - name: Checkout ${{ github.repository }}
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
          show-progress: false # spammy

      - name: Checkout folio-org/folio-tools
        uses: actions/checkout@v4
        with:
          repository: folio-org/folio-tools
          path: folio-tools
          fetch-depth: 1
          show-progress: false # spammy

      - id: calculate
        name: Calculate version number
        run: echo version=`./folio-tools/github-actions-scripts/folioci_npmver.sh` | tee -a $GITHUB_OUTPUT
        env:
          JOB_ID: ${{ github.run_number }}
